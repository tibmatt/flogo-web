<div [hidden]="loading">

  <div class="canvas-flow" *ngIf="flow && !loading" [ngClass]="{'canvas-flow--maximized': !hasTrigger}" >

    <section class="flogo-flow-detail"
             [ngClass]="{'flogo-flow-detail__device': profileType === PROFILE_TYPES.DEVICE,
                         'flogo-flow-detail__microservice': profileType === PROFILE_TYPES.MICRO_SERVICE}">

      <header class="flogo-flow-detail-header col-sm-9">
        <div class="flogo-flow-detail-header-back"
             [ngClass]="{'--hover':backToAppHover}">
          <div class="flogo-flow-detail-header-back-icon"
               (click)="navigateToApp()"
               (mouseover)="onMouseOverBackControl()"
               (mouseout)="onMouseOutBackControl()">
            <i class="flogo-icon flogo-icon-back"></i>
          </div>
          <div class="flogo-profile__tile flogo-profile-detail__thumb"
               [ngClass]="{'flogo-profile__device': profileType === PROFILE_TYPES.DEVICE,
                           'flogo-profile__microservice': profileType === PROFILE_TYPES.MICRO_SERVICE}"></div>
          <div>
            <div class="clearfix">
              <h3 class="flogo-flow-detail-name" [(myContenteditable)]="flow.name"
                  (myContenteditableChange)="changeFlowDetailName($event, 'name')"></h3>
              <span *ngIf="profileType === PROFILE_TYPES.DEVICE" class="flogo-profile__device-type">{{flow.app.device.deviceType}}</span>
            </div>
            <div>
              <span>in</span> <span (click)="navigateToApp()"
                                    class="flogo-flow-detail-header-back-app-name"
                                    (mouseover)="onMouseOverBackControl()"
                                    (mouseout)="onMouseOutBackControl()">{{flow.app?.name}}</span>
              <p class="flogo-flow-detail-description" [(myContenteditable)]="flow.description"
                 placeholder="{{ translate.instant('CANVAS:ADD-FLOW-DESCRIPTION') }}"
                 (myContenteditableChange)="changeFlowDetail($event, 'descrption')"></p>
            </div>
          </div>
        </div>
      </header>


      <div class="col-sm-3 flogo-flow-detail-menu-container">
        <flogo-run-flow *ngIf="profileType === PROFILE_TYPES.MICRO_SERVICE"
                        [disableRun]="disableRunFlow"
                        [flowInputs]="flow?.metadata?.input"
                        (onSubmit)="onRunFlow($event)"></flogo-run-flow>
        <div class="flogo-flow-detail-menu">
          <i class="flogo-icon-kebabmenu"></i>
          <div class="flogo-flow-detail-menu-list-wrapper">
            <ul class="flogo-flow-detail-menu-list">
              <!--<li class="flogo-flow-detail-menu-item"><a disabled href="javascript:void(0);"><i class="fa fa-clone fa-fw"></i>{{ 'CANVAS:COPY' | translate }}</a></li>-->
              <li class="flogo-flow-detail-menu-item">
                <a (click)="deleteFlow()" href="javascript:void(0);" class="flogo-flow-detail-menu-anchor">
                  <i class="flogo-icon flogo-icon-delete"></i>{{ 'CANVAS:DELETE' | translate }}
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="flogo-flow-detail-log-button-container">
          <flogo-logs></flogo-logs>
        </div>

      </div>

    </section>

    <div class="flogo-flow-container">
      <div class="clearfix flogo-flows-main">
        <div class="flogo-flows-triggers-container">
          <flogo-flows-detail-triggers-panel
            [triggers]="triggersList"
            [actionId]="flowId"
            [appDetails]="{appId: flow?.app?.id, appProfileType: profileType, metadata: flow?.metadata}"></flogo-flows-detail-triggers-panel>
        </div>

        <div class="flogo-flows-flow-schema-container" *ngIf="profileType === PROFILE_TYPES.MICRO_SERVICE">
          <flogo-flows-detail-flow-schema role="button"
                                          [flowMetadata]="flow?.metadata"
                                          (click)="openInputSchemaModal()">
          </flogo-flows-detail-flow-schema>
        </div>

        <div class="flogo-flows-diagram-container">
          <flogo-canvas-flow-diagram *ngIf="mainHandler"
                                     [tasks]="mainHandler.tasks"
                                     [diagram]="mainHandler.diagram"
                                     [id]="'root'"
                                     [appDetails]="{appId:flow?.app?.id, appProfileType: profileType}"
                                     [appId]="flow?.app?.id"
                                     data-flogo-diagram-id="root">
          </flogo-canvas-flow-diagram>
        </div>
      </div>
      <flogo-footer class="footer-wrapper"></flogo-footer>
    </div>

    <flogo-transform [flowId]="'root'" data-flogo-for-diagram-id="root"></flogo-transform>
    <flogo-transform [flowId]="'errorHandler'" data-flogo-for-diagram-id="errorHandler"></flogo-transform>

    <flogo-flows-detail-error-panel *ngIf="hasTrigger">
      <flogo-canvas-flow-diagram *ngIf="errorHandler"
                                 [tasks]="errorHandler.tasks"
                                 [diagram]="errorHandler.diagram"
                                 [appDetails]="{appId:flow?.app?.id, appProfileType: profileType}"
                                 [id]="'errorHandler'"
                                 data-flogo-diagram-id="root"></flogo-canvas-flow-diagram>
    </flogo-flows-detail-error-panel>

  </div>
  <div class="canvas-right-container">
    <router-outlet></router-outlet>
  </div>
  <flogo-flow-input-schema #inputSchemaModal [flow]="flow" (save)="onFlowSchemaSave($event)"></flogo-flow-input-schema>
</div>

