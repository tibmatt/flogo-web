<div class="go-back-container">
  <a routerLink="/apps" class="go-back"><i class="flogo-icon flogo-icon-back"></i></a>
</div>

<div class="background-image background-image--microservice">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    viewBox="0 0 653.40485 603.0666"
  >
    <defs>
      <style>
        .cls-1 {
          fill: none;
        }
      </style>
      <clipPath id="clip-path">
        <rect class="cls-1" x="5.90633" y="7.87608" width="583.6575" height="583.6575" />
      </clipPath>
      <clipPath id="clip-path-2">
        <rect class="cls-1" x="5.91087" y="7.87798" width="580.4103" height="581.15495" />
      </clipPath>
    </defs>
    <title>profiles</title>
    <rect class="cls-1" x="29.83126" y="29.77713" width="535.81649" height="535.81689" />
    <path
      d="M214.73668,229.64274a6.57932,6.57932,0,0,1-8.3269,5.31165,8.56328,8.56328,0,0,1-6.08295-9.02777A144.63089,144.63089,0,0,1,334.24669,108.49791a8.09615,8.09615,0,0,1,6.306,2.95544,5.57155,5.57155,0,0,1,1.87219,4.23456c.51367,4.11328-2.3183,7.22357-6.39386,7.52649A131.2574,131.2574,0,0,0,214.73668,229.64274Zm130.32617-43.33008a8.12437,8.12437,0,0,0-6.31946-2.95538c-15.613,1.24548-30.39459,6.97455-41.9657,17.05927a69.52644,69.52644,0,0,0-22.54755,39.85425,7.48013,7.48013,0,0,0,5.75177,8.65753c4.02155,1.05017,8.17822-1.26569,8.65808-4.94141a56.95685,56.95685,0,0,1,18.188-32.13922,54.33612,54.33612,0,0,1,33.36169-13.471,7.07281,7.07281,0,0,0,6.73187-7.82947A8.217,8.217,0,0,0,345.06285,186.31266Zm-62.86133-2.47742a94.92625,94.92625,0,0,1,56.41614-23.15851c4.0824-.29626,6.90753-3.42,6.39392-7.52649a8.27636,8.27636,0,0,0-8.17822-7.19,108.38231,108.38231,0,0,0-64.67548,26.44385A105.56016,105.56016,0,0,0,237.262,233.43766a8.1112,8.1112,0,0,0,5.73151,9.33075c4.04852.377,7.847-1.63593,8.67834-5.61462A92.15081,92.15081,0,0,1,282.20153,183.83525ZM653.40483,299.477a136.17574,136.17574,0,0,1-136.1261,136.126H494.67839L459.29216,578.99278a31.64918,31.64918,0,0,1-38.31042,23.14453L267.91094,564.3618a31.64926,31.64926,0,0,1-23.14441-38.31042L267.08782,435.603H163.35125C73.23583,435.603,0,362.36729,0,272.25193A163.19336,163.19336,0,0,1,145.65483,109.9896,204.07021,204.07021,0,0,1,326.70244,0C425.80217,0,508.29448,70.51316,526.80767,164.44,597.59307,169.34056,653.40483,227.60264,653.40483,299.477ZM354.72527,541.59849a11.997,11.997,0,1,0,8.77307,14.52209A11.99712,11.99712,0,0,0,354.72527,541.59849Zm136.6366-207.83423L330.46758,294.05821,277.52605,508.58384,438.42034,548.2899,466.22966,435.603l7.15674-29Zm-92.72253-44.08331,31.71851,7.68793a11.15047,11.15047,0,1,0,5.31128-21.65894l-31.725-7.68146a11.14658,11.14658,0,1,0-5.30475,21.65247Zm225.7655,9.79608a105.54639,105.54639,0,0,0-28.8457-72.73035A107.14966,107.14966,0,0,0,524.80474,193.371l-22.155-1.53394L498.355,170.0482a174.99569,174.99569,0,0,0-326.97974-46.66235l-7.18591,13.79675-15.46875,1.64465A134.19322,134.19322,0,0,0,29,272.25193C29,346.33335,89.2697,406.603,163.35125,406.603H274.24456l38.5498-156.2085a31.64913,31.64913,0,0,1,38.3103-23.14441l153.0708,37.77539A31.64923,31.64923,0,0,1,527.31987,303.336L501.83513,406.603h15.4436A107.24734,107.24734,0,0,0,624.40483,299.477Z"
    />
  </svg>
</div>

<div class="header">
  <ng-container class="flogo-app-details__icon-wrapper">
    <svg
      class="header__profile-icon header__profile-icon--microservice"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="-10 -10 653.40485 603.0666"
    >
      <defs>
        <style>
          .cls-1 {
            fill: none;
          }
        </style>
        <clipPath id="clip-path">
          <rect
            class="cls-1"
            x="5.90633"
            y="7.87608"
            width="583.6575"
            height="583.6575"
          />
        </clipPath>
        <clipPath id="clip-path-2">
          <rect
            class="cls-1"
            x="5.91087"
            y="7.87798"
            width="580.4103"
            height="581.15495"
          />
        </clipPath>
      </defs>
      <title>profiles</title>
      <rect
        class="cls-1"
        x="29.83126"
        y="29.77713"
        width="535.81649"
        height="535.81689"
      />
      <path
        d="M214.73668,229.64274a6.57932,6.57932,0,0,1-8.3269,5.31165,8.56328,8.56328,0,0,1-6.08295-9.02777A144.63089,144.63089,0,0,1,334.24669,108.49791a8.09615,8.09615,0,0,1,6.306,2.95544,5.57155,5.57155,0,0,1,1.87219,4.23456c.51367,4.11328-2.3183,7.22357-6.39386,7.52649A131.2574,131.2574,0,0,0,214.73668,229.64274Zm130.32617-43.33008a8.12437,8.12437,0,0,0-6.31946-2.95538c-15.613,1.24548-30.39459,6.97455-41.9657,17.05927a69.52644,69.52644,0,0,0-22.54755,39.85425,7.48013,7.48013,0,0,0,5.75177,8.65753c4.02155,1.05017,8.17822-1.26569,8.65808-4.94141a56.95685,56.95685,0,0,1,18.188-32.13922,54.33612,54.33612,0,0,1,33.36169-13.471,7.07281,7.07281,0,0,0,6.73187-7.82947A8.217,8.217,0,0,0,345.06285,186.31266Zm-62.86133-2.47742a94.92625,94.92625,0,0,1,56.41614-23.15851c4.0824-.29626,6.90753-3.42,6.39392-7.52649a8.27636,8.27636,0,0,0-8.17822-7.19,108.38231,108.38231,0,0,0-64.67548,26.44385A105.56016,105.56016,0,0,0,237.262,233.43766a8.1112,8.1112,0,0,0,5.73151,9.33075c4.04852.377,7.847-1.63593,8.67834-5.61462A92.15081,92.15081,0,0,1,282.20153,183.83525ZM653.40483,299.477a136.17574,136.17574,0,0,1-136.1261,136.126H494.67839L459.29216,578.99278a31.64918,31.64918,0,0,1-38.31042,23.14453L267.91094,564.3618a31.64926,31.64926,0,0,1-23.14441-38.31042L267.08782,435.603H163.35125C73.23583,435.603,0,362.36729,0,272.25193A163.19336,163.19336,0,0,1,145.65483,109.9896,204.07021,204.07021,0,0,1,326.70244,0C425.80217,0,508.29448,70.51316,526.80767,164.44,597.59307,169.34056,653.40483,227.60264,653.40483,299.477ZM354.72527,541.59849a11.997,11.997,0,1,0,8.77307,14.52209A11.99712,11.99712,0,0,0,354.72527,541.59849Zm136.6366-207.83423L330.46758,294.05821,277.52605,508.58384,438.42034,548.2899,466.22966,435.603l7.15674-29Zm-92.72253-44.08331,31.71851,7.68793a11.15047,11.15047,0,1,0,5.31128-21.65894l-31.725-7.68146a11.14658,11.14658,0,1,0-5.30475,21.65247Zm225.7655,9.79608a105.54639,105.54639,0,0,0-28.8457-72.73035A107.14966,107.14966,0,0,0,524.80474,193.371l-22.155-1.53394L498.355,170.0482a174.99569,174.99569,0,0,0-326.97974-46.66235l-7.18591,13.79675-15.46875,1.64465A134.19322,134.19322,0,0,0,29,272.25193C29,346.33335,89.2697,406.603,163.35125,406.603H274.24456l38.5498-156.2085a31.64913,31.64913,0,0,1,38.3103-23.14441l153.0708,37.77539A31.64923,31.64923,0,0,1,527.31987,303.336L501.83513,406.603h15.4436A107.24734,107.24734,0,0,0,624.40483,299.477Z"
      />
    </svg>
  </ng-container>

  <div class="header__details">
    <div
      class="flogo-app-header__name-container"
      [class.flogo-input--has-error]="nameUiState?.errors?.notUnique"
    >
      <input
        *ngIf="nameUiState.inEditMode"
        class="app-name--edit qa-name-input"
        type="text"
        fgAutofocus
        [(ngModel)]="nameUiState.value"
        fgEditableInput
        (editableInputSave)="onNameSave()"
        (editableInputCancel)="onNameCancel()"
        id="appName"
      />

      <label
        class="app-name is-editable qa-name-label"
        *ngIf="!nameUiState.inEditMode"
        (click)="onClickLabelName($event)"
        >{{ application?.name }}</label
      >

      <div class="flogo-input-error-msg" *ngIf="nameUiState?.errors?.notUnique">
        {{ 'APP-DETAIL:ERROR-UNIQUE-NAME' | translate }}
      </div>
    </div>
    <div class="flogo-app-header__date-container">
      <label class="flogo-app-header__date--creation"
        >{{ 'FLOWS:CREATED' | translate: { value: '' }
        }}<span class="qa-creation-date"
          >{{ application?.createdAt | timeFromNow }}.</span
        >
      </label>
      <label *ngIf="application?.updatedAt" class="flogo-app-header__date--update"
        >{{ 'FLOWS:EDITED' | translate: { value: '' }
        }}<span>{{ application?.updatedAt | timeFromNow }}.</span>
      </label>
    </div>

    <div class="flogo-app-header__description-container">
      <a
        *ngIf="application && !application?.description && !descriptionUiState.inEditMode"
        class="flogo-link qa-add-description"
        (click)="onClickAddDescription()"
        >{{ 'DETAILS:ADD-DESCRIPTION' | translate }}</a
      >
      <textarea
        *ngIf="descriptionUiState.inEditMode"
        fgAutofocus
        placeholder="Description"
        rows="3"
        [(ngModel)]="descriptionUiState.value"
        fgEditableInput
        (editableInputSave)="onDescriptionSave()"
        (editableInputCancel)="onDescriptionCancel()"
        id="appDescription"
        class="flogo-app-header__description--edit"
      >
      </textarea>
      <label
        class="flogo-app-header__description is-editable qa-description-label"
        *ngIf="!descriptionUiState.inEditMode && !!descriptionUiState.value"
        (click)="onClickLabelDescription()"
        >{{ descriptionUiState.value }}</label
      >
    </div>
  </div>

  <div class="header__options">
    <div class="menu-dropdown" (fgClickOutside)="closeExportBox()">
      <button
        class="flogo-button--secondary menu-dropdown__trigger"
        (click)="toggleExportBox()"
        id="exportMenuButton"
        aria-haspopup="true"
        [attr.aria-expanded]="isExportBoxShown"
      >
        <span class="menu-dropdown__button-label">{{
          'DETAILS:EXPORT' | translate
        }}</span>
        <span class="flogo-icon flogo-icon-back flogo-button-dropdown-caret"></span>
      </button>
      <div
        class="menu-dropdown__content menu-dropdown__content--export"
        [class.active]="isExportBoxShown"
        aria-labelledby="exportMenuButton"
      >
        <ul class="dropdown-list">
          <li class="dropdown-list__item" [fgJsonDownloader]="appExporter()">
            <a class="dropdown-list__item-link"
              ><span>{{ 'DETAILS:EXPORT-APP' | translate }} </span></a
            >
          </li>

          <li class="dropdown-list__item" (click)="openExportFlow()">
            <a class="dropdown-list__item-link"
              ><span>{{ 'DETAILS:EXPORT-FLOW' | translate }}</span></a
            >
          </li>
        </ul>
      </div>
    </div>
    <div (fgClickOutside)="closeBuildBox()" class="menu-dropdown">
      <button
        class="flogo-button--default menu-dropdown__trigger"
        [disabled]="isBuilding"
        (click)="toggleBuildBox()"
        id="buildMenuButton"
        aria-haspopup="true"
        [attr.aria-expanded]="isBuildBoxShown"
      >
        <ng-container *ngIf="!isBuilding; else buildIndicator">
          <span class="menu-dropdown__button-label">{{
            'DETAILS:BUILD' | translate
          }}</span>
          <span class="flogo-icon flogo-icon-back flogo-button-dropdown-caret"></span>
        </ng-container>
        <ng-template #buildIndicator>{{ 'DETAILS:BUILDING' | translate }}</ng-template>
      </button>
      <div
        class="menu-dropdown__content menu-dropdown__content--build"
        aria-labelledby="buildMenuButton"
        [class.active]="isBuildBoxShown"
      >
        <ul class="dropdown-list">
          <li *ngFor="let opt of buildOptions" class="dropdown-list__item">
            <a class="dropdown-list__item-link" (click)="buildApp(opt)">
              <span>{{ opt.label }} </span>
            </a>
          </li>
        </ul>
        <ul
          class="dropdown-list dropdown-list--subsection"
          *ngIf="shimTriggerOptions.length > 0"
        >
          <li *ngFor="let opt of shimTriggerOptions" class="dropdown-list__item">
            <span
              class="dropdown-list__item-link"
              (click)="openShimmableActionsFor(opt.ref)"
              >{{ opt.labelKey | translate }}</span
            >
          </li>
        </ul>
      </div>
    </div>
    <div class="menu-dropdown" (fgClickOutside)="closeDetailsMenu()">
      <i
        class="flogo-icon-kebabmenu kebabmenu-icon menu-dropdown-more-button"
        [class.active]="isDetailsMenuOpen"
        (click)="toggleDetailsMenu()"
        role="button"
        id="detailsMenuButton"
        aria-haspopup="true"
        [attr.aria-expanded]="isDetailsMenuOpen"
      ></i>
      <div
        class="menu-dropdown__content menu-dropdown__content--more"
        aria-labelledby="detailsMenuButton"
        [class.active]="isDetailsMenuOpen"
      >
        <ul class="dropdown-list">
          <li class="dropdown-list__item">
            <a (click)="onDeleteApp(application)" class="dropdown-list__item-link">
              <i class="flogo-icon flogo-icon-delete"></i
              >{{ 'APP-DETAILS:DELETE-APP' | translate }}
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="flogo-app-detail-commands">
  <flogo-resource-views-selector
    [viewType]="resourceViewType"
    (changeView)="resourceViewChanged($event)"
  ></flogo-resource-views-selector>
  <button class="flogo-button--flat btn-create-flow" (click)="openCreateResource()">
    <i class="flogo-icon-add"></i>{{ 'DETAILS:NEW-RESOURCE' | translate }}
  </button>
</div>

<div class="content-empty" *ngIf="(appDetailService.isEmpty$ | async)">
  <img src="/assets/svg/flogo.flynn-placeholder.svg" />
  <p class="content-empty__message">{{ 'APP-DETAILS:NO-RESOURCES-FOUND' | translate }}</p>
  <button class="flogo-button--default" (click)="openCreateResource()">
    {{ 'DETAILS:CREATE-A-RESOURCE' | translate }}
  </button>
</div>

<ng-container *ngIf="resourceViewType === 'resources'; else resourcesGroupedByTrigger">
  <flogo-apps-resource-views-by-resource
    *ngFor="let triggerGroup of (appDetailService.groupsByResource$ | async)"
    [triggers]="triggerGroup.triggers"
    [resource]="triggerGroup.flow"
    (resourceSelected)="onResourceSelected($event)"
    (deleteResource)="onFlowDelete($event)"
  ></flogo-apps-resource-views-by-resource>
</ng-container>
<ng-template #resourcesGroupedByTrigger>
  <flogo-apps-resource-views-by-trigger
    *ngFor="let resourceGroup of (appDetailService.groupsByTrigger$ | async)"
    [trigger]="resourceGroup.trigger"
    [resources]="resourceGroup.flows"
    (resourceSelected)="onResourceSelected($event)"
    (deleteResource)="onFlowDelete($event)"
    (addResource)="openCreateFlowFromTrigger($event)"
  ></flogo-apps-resource-views-by-trigger>
</ng-template>
